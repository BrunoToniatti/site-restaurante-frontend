<app-navebar></app-navebar>

<div class="reservation-container">
  <!-- Header da página -->
  <div class="reservation-header">
    <div class="header-content">
      <h1 class="page-title">
        Faça sua <span class="title-highlight">Reserva</span>
      </h1>
      <p class="page-subtitle">
        Reserve sua mesa e garanta uma experiência gastronômica inesquecível no J&B Restaurante
      </p>
    </div>
  </div>

  <!-- Barra de progresso -->
  <div class="progress-container">
    <div class="progress-bar">
      <div class="progress-fill" [style.width.%]="getStepProgress()"></div>
    </div>
    <div class="progress-steps">
      <div class="step" [class.active]="formStep >= 1" [class.completed]="formStep > 1">
        <span class="step-number">1</span>
        <span class="step-label">Data</span>
      </div>
      <div class="step" [class.active]="formStep >= 2" [class.completed]="formStep > 2">
        <span class="step-number">2</span>
        <span class="step-label">Horário</span>
      </div>
      <div class="step" [class.active]="formStep >= 3" [class.completed]="formStep > 3">
        <span class="step-number">3</span>
        <span class="step-label">Mesa</span>
      </div>
      <div class="step" [class.active]="formStep >= 4" [class.completed]="formStep > 4">
        <span class="step-number">4</span>
        <span class="step-label">Dados</span>
      </div>
    </div>
  </div>

  <!-- Formulário de reserva -->
  <div class="reservation-form" *ngIf="!showSuccess">

    <!-- Etapa 1: Seleção de Data -->
    <div class="form-step" *ngIf="formStep === 1">
      <div class="step-header">
        <h2>Escolha a Data</h2>
        <p>Selecione o dia para sua reserva</p>
      </div>

      <div class="calendar-container">
        <div class="calendar-header">
          <button class="nav-btn" (click)="previousMonth()" type="button">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>

          <h3 class="month-year">{{ months[selectedMonth] }} {{ selectedYear }}</h3>

          <button class="nav-btn" (click)="nextMonth()" type="button">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>

        <div class="calendar-grid">
          <div class="weekday" *ngFor="let day of weekDays">{{ day }}</div>
          <div
            class="calendar-day"
            *ngFor="let day of getCalendarDays()"
            [class.empty]="day === 0"
            [class.past]="isPastDate(day)"
            [class.selected]="isSelectedDate(day)"
            (click)="selectDate(day)"
          >
            <span *ngIf="day !== 0">{{ day }}</span>
          </div>
        </div>
      </div>

      <div class="step-actions">
        <button
          class="btn btn-primary"
          [disabled]="!isStepValid()"
          (click)="nextStep()"
          type="button"
        >
          Continuar
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Etapa 2: Seleção de Horário -->
    <div class="form-step" *ngIf="formStep === 2">
      <div class="step-header">
        <h2>Escolha o Horário</h2>
        <p>Selecione o melhor horário para sua reserva</p>
      </div>

      <div class="time-grid">
        <button
          class="time-slot"
          *ngFor="let slot of timeSlots"
          [class.selected]="reservationForm.time === slot.time"
          [class.unavailable]="!slot.available"
          [disabled]="!slot.available"
          (click)="selectTime(slot.time)"
          type="button"
        >
          {{ slot.time }}
          <span class="availability" *ngIf="!slot.available">Indisponível</span>
        </button>
      </div>

      <div class="step-actions">
        <button class="btn btn-secondary" (click)="previousStep()" type="button">
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Voltar
        </button>
        <button
          class="btn btn-primary"
          [disabled]="!isStepValid()"
          (click)="nextStep()"
          type="button"
        >
          Continuar
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Etapa 3: Seleção de Mesa -->
    <div class="form-step" *ngIf="formStep === 3">
      <div class="step-header">
        <h2>Escolha sua Mesa</h2>
        <p>Quantas pessoas e qual mesa preferem?</p>
      </div>

      <div class="guests-selector">
        <label for="guests">Número de pessoas:</label>
        <select id="guests" [(ngModel)]="reservationForm.guests" class="select-input">
          <option value="1">1 pessoa</option>
          <option value="2">2 pessoas</option>
          <option value="3">3 pessoas</option>
          <option value="4">4 pessoas</option>
          <option value="5">5 pessoas</option>
          <option value="6">6 pessoas</option>
          <option value="7">7 pessoas</option>
          <option value="8">8 pessoas</option>
          <option value="9">9 pessoas</option>
          <option value="10">10+ pessoas</option>
        </select>
      </div>

      <div class="tables-grid">
        <div
          class="table-card"
          *ngFor="let table of getAvailableTables()"
          [class.selected]="reservationForm.table === table.id"
          (click)="selectTable(table.id)"
        >
          <div class="table-icon">
            <svg viewBox="0 0 24 24" fill="none">
              <rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
              <circle cx="8.5" cy="8.5" r="1.5" fill="currentColor"/>
              <circle cx="15.5" cy="8.5" r="1.5" fill="currentColor"/>
              <circle cx="8.5" cy="15.5" r="1.5" fill="currentColor"/>
              <circle cx="15.5" cy="15.5" r="1.5" fill="currentColor"/>
            </svg>
          </div>
          <h4>{{ table.name }}</h4>
          <p>Até {{ table.capacity }} pessoas</p>
        </div>
      </div>

      <div class="step-actions">
        <button class="btn btn-secondary" (click)="previousStep()" type="button">
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Voltar
        </button>
        <button
          class="btn btn-primary"
          [disabled]="!isStepValid()"
          (click)="nextStep()"
          type="button"
        >
          Continuar
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Etapa 4: Dados Pessoais -->
    <div class="form-step" *ngIf="formStep === 4">
      <div class="step-header">
        <h2>Finalize sua Reserva</h2>
        <p>Preencha seus dados para confirmar</p>
      </div>

      <div class="form-fields">
        <div class="field-group">
          <label for="name">Nome completo *</label>
          <input
            type="text"
            id="name"
            [(ngModel)]="reservationForm.name"
            placeholder="Seu nome completo"
            class="form-input"
          >
        </div>

        <div class="field-group">
          <label for="email">E-mail *</label>
          <input
            type="email"
            id="email"
            [(ngModel)]="reservationForm.email"
            placeholder="seu@email.com"
            class="form-input"
          >
        </div>

        <div class="field-group">
          <label for="phone">Telefone *</label>
          <input
            type="tel"
            id="phone"
            [(ngModel)]="reservationForm.phone"
            (input)="formatPhone($event)"
            placeholder="(11) 99999-9999"
            class="form-input"
          >
        </div>

        <div class="field-group">
          <label for="requests">Observações especiais</label>
          <textarea
            id="requests"
            [(ngModel)]="reservationForm.specialRequests"
            placeholder="Alguma observação especial? (opcional)"
            class="form-textarea"
            rows="3"
          ></textarea>
        </div>
      </div>

      <!-- Resumo da reserva -->
      <div class="reservation-summary">
        <h3>Resumo da Reserva</h3>
        <div class="summary-items">
          <div class="summary-item">
            <span class="label">Data:</span>
            <span class="value">{{ selectedDate | date:'dd/MM/yyyy' }}</span>
          </div>
          <div class="summary-item">
            <span class="label">Horário:</span>
            <span class="value">{{ reservationForm.time }}</span>
          </div>
          <div class="summary-item">
            <span class="label">Mesa:</span>
            <span class="value">{{ getSelectedTableName() }}</span>
          </div>
          <div class="summary-item">
            <span class="label">Pessoas:</span>
            <span class="value">{{ reservationForm.guests }}</span>
          </div>
        </div>
      </div>

      <div class="step-actions">
        <button class="btn btn-secondary" (click)="previousStep()" type="button">
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Voltar
        </button>
        <button
          class="btn btn-primary"
          [disabled]="!isStepValid() || isSubmitting"
          (click)="submitReservation()"
          type="button"
        >
          <span *ngIf="!isSubmitting">Confirmar Reserva</span>
          <span *ngIf="isSubmitting">Enviando...</span>
          <svg *ngIf="!isSubmitting" viewBox="0 0 24 24" fill="none">
            <path d="M22 2L11 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M22 2L15 22L11 13L22 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <div *ngIf="isSubmitting" class="loading-spinner"></div>
        </button>
      </div>
    </div>
  </div>

  <!-- Tela de sucesso -->
  <div class="success-container" *ngIf="showSuccess">
    <div class="success-content">
      <div class="success-icon">
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M9 12L11 14L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
        </svg>
      </div>
      <h2>Reserva Confirmada!</h2>
      <p>Sua reserva foi realizada com sucesso. Enviamos uma confirmação para o seu e-mail.</p>
      <div class="success-details">
        <div class="detail-item">
          <strong>Data:</strong> {{ selectedDate | date:'dd/MM/yyyy' }}
        </div>
        <div class="detail-item">
          <strong>Horário:</strong> {{ reservationForm.time }}
        </div>
        <div class="detail-item">
          <strong>Mesa:</strong> {{ getSelectedTableName() }}
        </div>
      </div>
      <button class="btn btn-primary" (click)="resetForm()" type="button">
        Nova Reserva
      </button>
    </div>
  </div>
</div>
